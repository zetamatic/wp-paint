window.wp=window.wp||{},function(e,t){wp.media.wpp_modals_queue=[],wp.media.view.Modal.prototype._open=wp.media.view.Modal.prototype.open,wp.media.wpp_modal_close_refresh_url=!1,wp.media.view.Modal=wp.media.view.Modal.extend({open:function(){return wp.media.wpp_modals_queue.length>3&&wp.media.wpp_modals_queue.shift(),wp.media.wpp_modals_queue.push(this),wp.media.view.Modal.prototype._open.apply(this,arguments)}}),wp.media.view.Attachment.Details.prototype._attributes=wp.media.view.Attachment.Details.prototype.attributes,wp.media.view.Attachment.Details.prototype.attributes=function(){return{tabIndex:0,"data-id":this.model.get("id")}},wp.media.wpp_refresh_frame=function(){null!==wp.media.frame.content.get()&&wp.media.frame.content.get().collection&&wp.media.frame.content.get().collection.props?(wp.media.frame.content.get().collection.props.set({ignore:+new Date}),wp.media.frame.content.get().options.selection.reset()):wp.media.frame.library.props.set({ignore:+new Date})},window.onload=function(){window.addEventListener("beforeunload",function(e){if(!(t("#wpp-editor-frame:visible").length<1)){var a=t("#wpp-editor-frame:visible")[0].contentWindow,i="You have unsaved changes! \n\nYour changes will be lost if you close this item without saving.";if(a.MP_Base_state&&a.MP_Base_state.layers_archive){var n=a.MP_Base_state.layers_archive;return n.length<1||null==n[0]?void 0:((e||window.event).returnValue=i,i)}}})},t.initialize(".media-modal-close",function(){t(this).on("click",function(){if(t("#wpp-editor-frame:visible").length<1)return!0;var e=t("#wpp-editor-frame:visible")[0].contentWindow;if(e.MP_Base_state&&e.MP_Base_state.layers_archive){var a=e.MP_Base_state.layers_archive;return a.length<1||null==a[0]||confirm("You have unsaved changes! \n\nYour changes will be lost if you close this item without saving.")}return!0})}),t.initialize(".edit-attachment",function(){var e=t(this),a=e.parents(".attachment-details"),i=a.data("id"),n=a.parent().find(".wpp-edit-attachment");if(!(!i||a.length<1||e.length<1||n.length>0)){n=jQuery('<a href="javascript:void(0);" class="wpp-edit-attachment" data-attachment-id="'+i+'">Edit Image using WP Paint</a>');e.after(n),e.hasClass("button")&&n.addClass("button"),n.click(function(){var e=t(this),a=e.data("attachmentId"),i=e.parents().find(".media-frame").length>0;window.location.search.match("item=")&&window.location.href.match("upload.php")?wp.media.wpp_modal_close_refresh_url=window.location.href:wp.media.wpp_modal_close_refresh_url=!1,window.wpp_open_editor(a,function(e){var t=wp.media.wpp_modals_queue.length;t>1&&i&&wp.media.wpp_modals_queue[t-2].controller.close()},function(e){var t=wp.media.wpp_modals_queue.length;t>1&&i&&(wp.media.wpp_modals_queue[t-2].controller.open(),wp.media.wpp_refresh_frame());wp.media.wpp_modal_close_refresh_url&&wp.media.wpp_modal_close_refresh_url.match(/^https?:\/\//g)&&(window.location.href=wp.media.wpp_modal_close_refresh_url)})})}}),window.wpp_open_editor=function(e,a,i){a=void 0===a?null:a,i=void 0===i?null:i;var n=wp.media.frames.wpp_edit_attachment_frame=wp.media({button:{},title:"WP Paint",toolbar:null});n.on("open",function(){var t=n.$el.parent().parent();t.addClass("wp-paint-modal"),t.find(".media-frame-title>h1").text("WP Paint"),t.find(".edit-media-header").hide(),t.find(".media-frame-router").remove(),t.find(".media-frame-toolbar").remove(),t.find(".media-frame-content").css({overflow:"hidden",top:"50px",bottom:"0px"}),t.find(".media-frame-content").html('<iframe src="'+wp_paint_admin_meta.wp_admin_url+"admin.php?page=wp-paint-edit-image&id="+e+"&_="+Math.random()+'" id="wpp-editor-frame" frameborder="0" style="width: 100%; height: 100%; border: none;"></iframe>'),a&&a(this)}),n.on("close",function(){n.$el.parent().parent().find(".media-frame-content").html("<center><strong></strong></center>"),t("#post_type").length>0&&"attachment"==t("#post_type").val()&&window.location.reload(),i&&i(this)}),n.open()};t(function(){!function(){if(!(t("#post_type").length<1||t("#post_ID").length<1||"attachment"!=t("#post_type").val())){var e=t("#post_ID").val(),a=t('.wp_attachment_image input[type="button"][id^="imgedit-open-btn-"]'),i=t('<button type="button" class="button wpp-edit-attachment" data-attachment-id="'+e+'">Edit Image Using WP-Paint</button>');i.click(function(){var e=t(this).data("attachmentId");window.wpp_open_editor(e)}),a.after(i)}}()})}(wp,jQuery);
