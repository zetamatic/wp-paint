!function(e){e.blockUI.defaults=e.extend(e.blockUI.defaults,{message:"Loading ...",css:{padding:0,margin:0,width:"100%",top:"50%",left:"0%",textAlign:"center",color:"#000",border:"none",backgroundColor:"transparent",cursor:"default",fontSize:"16px",lineHeight:"24px",height:"24px",marginTop:"-12px"},overlayCSS:{backgroundColor:"#f9f9fa",opacity:.6,cursor:"default"}}),window.top==window.self&&(window.top.location.href=wp_paint_meta.wp_admin_url),window.wpp_enable_color_memory=function(){window.MP_GUI.GUI_colors._change_color=window.MP_GUI.GUI_colors.change_color,window.MP_GUI.GUI_colors.change_color=function(e,a,i,t){window.MP_GUI.GUI_colors._change_color(e,a,i,t),window.MP_GUI.Helper.setCookie("selected_color",e)}},window.wpp_canvas_to_image=function(e,a,i){var t,o=e.width,n=e.height,p=e.getContext("2d");if(i){t=p.getImageData(0,0,o,n);var r=p.globalCompositeOperation;p.globalCompositeOperation="destination-over",p.fillStyle=i,p.fillRect(0,0,o,n)}var _=e.toDataURL(a);return i&&(p.clearRect(0,0,o,n),p.putImageData(t,0,0),p.globalCompositeOperation=r),_},window.wpp_open_url=function(a,i){if(""!=a){if(void 0===i)i=window.State.Base_layers;var t=a.replace(/^.*[\\\/]/,""),o=a.substring(a.lastIndexOf("/")+1).split(/\?|\#/)[0].split(".").pop().toLowerCase(),n={jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png"},p="";void 0!==n[o]&&(p=n[o]),e("#wpp-image-data").data("imageExtension",o),e("#wpp-image-data").data("imageMimeType",p);var r=new Image;r.crossOrigin="Anonymous",r.onload=function(){var a=r.width,o=r.height;if(r.width>wp_paint_meta.max_width||r.height>wp_paint_meta.max_height){var n=r.width/r.height;n>1?(a=wp_paint_meta.max_width,(o=Math.round(wp_paint_meta.max_width/n))>Number(wp_paint_meta.max_height)&&(o=wp_paint_meta.max_height,a=Math.round(wp_paint_meta.max_height*n))):(o=wp_paint_meta.max_height,(a=Math.round(n*wp_paint_meta.max_height))>Number(wp_paint_meta.max_width)&&(a=wp_paint_meta.max_width,o=Math.round(wp_paint_meta.max_width/n)))}var p={name:t,type:"image",link:r,width:a,height:o,width_original:r.width,height_original:r.height};i.insert(p),i.autoresize(a,o),e("#wpp-loading").remove()},r.onerror=function(e){alertify.error("Sorry, image could not be loaded. Try copy image and paste it.")},r.src=a}},window.addEventListener("load",function(a){window.MP_GUI.load_modules(),window.MP_GUI.load_default_values(),null==window.MP_GUI.Helper.getCookie("toggle_info")&&window.MP_GUI.Helper.setCookie("toggle_info",0),null==window.MP_GUI.Helper.getCookie("toggle_colors")&&window.MP_GUI.Helper.setCookie("toggle_colors",0),null==window.MP_GUI.Helper.getCookie("toggle_details")&&window.MP_GUI.Helper.setCookie("toggle_details",0);var i=window.MP_GUI.Helper.getCookie("selected_color");AppConfig.COLOR=i&&i.match(/^#((0x){0,1}|#{0,1})([0-9A-F]{8}|[0-9A-F]{6})$/gi)?i:"#333333",AppConfig.TRANSPARENCY=!0,AppConfig.TOOLS=AppConfig.TOOLS.filter(function(e){return-1==["media","animation","clone"].indexOf(e.name)}),AppConfig.themes=["light","dark","green"],window.MP_GUI.render_main_gui(),window.MP_Layers.init(),wp_paint_meta&&wp_paint_meta.attachment_url&&window.wpp_open_url(wp_paint_meta.attachment_url),window.wpp_enable_color_memory(),AppConfig.mp_version=wp_paint_meta.wpp_version,e("#wpp-save-image-button").on("click",function(){var a=document.createElement("canvas"),i=a.getContext("2d"),t=window.MP_Layers.get_dimensions(),o=t.width,n=t.height;a.width=o,a.height=n,window.MP_Layers.convert_layers_to_canvas(i);var p=e("#wpp-image-data").data("imageExtension"),r=e("#wpp-image-data").data("imageMimeType"),_="";-1!=e.inArray(p,["jpg","jpeg"])&&(_="#FFFFFF");var w=window.wpp_canvas_to_image(a,r,_);e("#wpp-image-data").val(w),e("#wpp-save-image-form").submit()}),e("#wpp-save-image-form").on("submit",function(){e.blockUI({message:"Please wait ... Saving Image ..."})}),e("#wpp-restore-image-form").on("submit",function(){e.blockUI({message:"Please wait ... Restoring Original Image ..."})})},!1)}(jQuery);
